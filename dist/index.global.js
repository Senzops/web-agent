(()=>{var v=Object.create;var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var h=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof require<"u"?require:t)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var x=(e,t,i,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of I(t))!b.call(e,r)&&r!==i&&g(e,r,{get:()=>t[r],enumerable:!(o=y(t,r))||o.enumerable});return e};var m=(e,t,i)=>(i=e!=null?v(S(e)):{},x(t||!e||!e.__esModule?g(i,"default",{value:e,enumerable:!0}):i,e));var u=m(h("crypto")),a=new Uint8Array(256),s=a.length;function p(){return s>a.length-16&&(u.default.randomFillSync(a),s=0),a.slice(s,s+=16)}var n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function f(e,t=0){return n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]}var w=m(h("crypto")),l={randomUUID:w.default.randomUUID};function P(e,t,i){if(l.randomUUID&&!t&&!e)return l.randomUUID();e=e||{};let o=e.random||(e.rng||p)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){i=i||0;for(let r=0;r<16;++r)t[i+r]=o[r];return t}return f(o)}var d=P;var c=class{config;startTime;endpoint;constructor(){this.config={webId:"",endpoint:"https://api.senzor.dev/api/ingest/web"},this.startTime=Date.now(),this.endpoint=""}init(t){if(this.config={...this.config,...t},this.endpoint=this.config.endpoint||"https://api.senzor.dev/api/ingest/web",!this.config.webId){console.error("[Senzor] WebId is required to initialize analytics.");return}this.initSession(),this.trackPageView(),this.setupListeners()}initSession(){let t=localStorage.getItem("senzor_vid");t||(t=d(),localStorage.setItem("senzor_vid",t));let i=sessionStorage.getItem("senzor_sid");i||(i=d(),sessionStorage.setItem("senzor_sid",i))}getIds(){return{visitorId:localStorage.getItem("senzor_vid")||"unknown",sessionId:sessionStorage.getItem("senzor_sid")||"unknown"}}trackPageView(){this.startTime=Date.now();let t={type:"pageview",webId:this.config.webId,...this.getIds(),url:window.location.href,path:window.location.pathname,referrer:document.referrer,width:window.innerWidth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone};this.send(t)}trackPing(){let t=Math.floor((Date.now()-this.startTime)/1e3);if(t<1)return;let i={type:"ping",webId:this.config.webId,...this.getIds(),url:window.location.href,path:window.location.pathname,referrer:document.referrer,width:window.innerWidth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,duration:t};this.send(i)}send(t){if(navigator.sendBeacon){let i=new Blob([JSON.stringify(t)],{type:"application/json"});navigator.sendBeacon(this.endpoint,i)||this.fallbackSend(t)}else this.fallbackSend(t)}fallbackSend(t){fetch(this.endpoint,{method:"POST",body:JSON.stringify(t),keepalive:!0,headers:{"Content-Type":"application/json"}}).catch(i=>console.error("[Senzor] Failed to send telemetry:",i))}setupListeners(){let t=history.pushState;history.pushState=(...i)=>{this.trackPing(),t.apply(history,i),this.trackPageView()},window.addEventListener("popstate",()=>{this.trackPing(),this.trackPageView()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this.trackPing():this.startTime=Date.now()}),window.addEventListener("beforeunload",()=>{this.trackPing()})}},k=new c;typeof window<"u"&&(window.Senzor=k);})();
